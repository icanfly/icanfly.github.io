<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="侠客行舟|技术博客|Java|分布式|架构|大数据"><title>升级Ambari中的Presto组件 | LP's Notes</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">升级Ambari中的Presto组件</h1><a id="logo" href="/.">LP's Notes</a><p class="description">侠客行舟 不进则退</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">升级Ambari中的Presto组件</h1><div class="post-meta">Aug 9, 2017<span> | </span><span class="category"><a href="/categories/原创文章/">原创文章</a></span></div><div class="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在几天前我的一篇文章中，提到了需要升级公司的Presto数据查询引擎，而我们的Presto引擎是由Ambari管理的，升级Presto并没有任何文档可以参考，都是自己不断摸索出来的路子。所以写下本文用于记录摸索过程，并留待以后方便追溯和查看。</p>
<p>对于Ambari管理的组件，对于HDP发行版来说，单个组件的升级可能导致HDP发行版其它组件间的冲突，所以Ambari并没有提供单个组件的升级。而Ambari提供的升级方式是Ambari主控台先进行升级，升级后的Ambari可以在WEB界面上完成各个组件的升级，这样所有组件的统一升级的结果是：拥有最新的比较稳定的版本，且各组件间可以很好的配合使用，不会出现冲突，这个是Hortonworks公司帮我已经解决的依赖及冲突问题，这也是使用类似CDH或者HDP这样的Hadoop发行版的原因，省事！</p>
<p>当然值得一提的是，升级大数据平台组件是一件需要非常谨慎又小心的事情，不到万不得已请不要贸然升级，升级前还要做好万全的准备，比如数据备份，升级计划梳理，灾难预案等等。</p>
<p>我这里升级的是Presto，是一个比较独立的组件，所以我打算单独升级它，并不使用整体升级Ambari来更新所有的组件，而且当前Presto并没有提供更新的Ambari插件，所以这里需要我自己进行一些Hack。</p>
<a id="more"></a>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><p>虽然是在测试环境试验，但是仍然需要先对数据及配置进行备份，这是升级必备要做的事。而备份对于Presto引擎来说只限于备份配置数据，Presto引擎本身是基本纯内存计算的数据查询引擎，故并不存在持久化于磁盘之上的数据。</p>
<h2 id="准备Presto升级用的RPM包"><a href="#准备Presto升级用的RPM包" class="headerlink" title="准备Presto升级用的RPM包"></a>准备Presto升级用的RPM包</h2><p>根据Presto Ambari插件源码，它是通过Maven仓库进行下载的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[download]</span><br><span class="line">presto_rpm_url = http://search.maven.org/remotecontent?filepath=com/facebook/presto/presto-server-rpm/0.161/presto-server-rpm-0.161.rpm</span><br><span class="line">presto_cli_url = http://search.maven.org/remotecontent?filepath=com/facebook/presto/presto-cli/0.161/presto-cli-0.161-executable.jar</span><br></pre></td></tr></table></figure></p>
<p>这里因为国内的一些因素从Maven中央仓库下载会非常缓慢，可以改成自己的私源Maven仓库或者将RPM包和Jar包从中央仓库手动下载后上传至私有静态文件服务器，然后把上面的文件路径地址改成你添加的新位置。</p>
<p>同时，因为目前最新的Presto RPM包版本为0.182，所以推荐将老版本的RPM包和Jar包更新成最新版，因为新版本还是解决了很多问题，其中有一个内存泄漏的问题，在前面的文章中提及过，也是为什么要升级Presto的原因。</p>
<p>具体链接如下：<a href="/2017/08/08/troubleshooting-of-outofmemory-in-presto/">Presto内存溢出(OutOfMemory)问题排查</a></p>
<h2 id="备份原有的Presto配置"><a href="#备份原有的Presto配置" class="headerlink" title="备份原有的Presto配置"></a>备份原有的Presto配置</h2><p>原有的Presto配置文件是通过Ambari Web管理控制台进行配置的，目前来看并没有针对单个组件的备份方式，Ambari<a href="https://ambari.apache.org/current/installing-hadoop-using-ambari/content/ambari-chap11-1.html" target="_blank" rel="noopener">整体备份方式</a>是通过备份ambari的数据库表来达到的，这不是我们想要的。</p>
<p>既然没有简单的备份方式，那么唯一可做的就是将每个配置项扣出来，自己通过某个方式进行备份。通过分析Ambari Web主控台的交互，发现有一个Web API可以获取到服务组件的配置，该API接口返回Json结构数据，这个Json数据可以用来作为备份数据：</p>
<blockquote>
<p>API接口形如：<code>/api/v1/clusters/test_cluster/configurations/service_config_versions?service_name.in(PRESTO)&amp;is_current=true&amp;fields=*&amp;_=1502331979100</code><br>  {test_cluster}为集群的名称，需要根据自己的实际Ambari集群进行修改<br>  {PRESTO}为安装的Presto服务名字，这个也需要根据自己安装定义的Presto服务组件名称指定</p>
</blockquote>
<p>返回数据形式如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"http://172.17.31.251:8080/api/v1/clusters/test_cluster/configurations/service_config_versions?service_name.in(PRESTO)&amp;is_current=true&amp;fields=*&amp;_=1502331979100"</span>,</span><br><span class="line">  <span class="attr">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"http://172.17.31.251:8080/api/v1/clusters/test_cluster/configurations/service_config_versions?service_name=PRESTO&amp;service_config_version=3"</span>,</span><br><span class="line">      <span class="attr">"cluster_name"</span> : <span class="string">"test_cluster"</span>,</span><br><span class="line">      <span class="attr">"configurations"</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"Config"</span> : &#123;</span><br><span class="line">            <span class="attr">"cluster_name"</span> : <span class="string">"test_cluster"</span>,</span><br><span class="line">            <span class="attr">"stack_id"</span> : <span class="string">"HDP-2.5"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"config.properties"</span>,</span><br><span class="line">          <span class="attr">"tag"</span> : <span class="string">"version1502248133724"</span>,</span><br><span class="line">          <span class="attr">"version"</span> : <span class="number">9</span>,</span><br><span class="line">          <span class="attr">"properties"</span> : &#123;</span><br><span class="line">            <span class="attr">"discovery.uri"</span> : <span class="string">"http://master.hdp.test.cq:8285"</span>,</span><br><span class="line">            <span class="attr">"http-server.http.port"</span> : <span class="string">"8285"</span>,</span><br><span class="line">            <span class="attr">"node-scheduler.include-coordinator"</span> : <span class="string">"false"</span>,</span><br><span class="line">            <span class="attr">"query.max-memory"</span> : <span class="string">"50"</span>,</span><br><span class="line">            <span class="attr">"query.max-memory-per-node"</span> : <span class="string">"1"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"properties_attributes"</span> : &#123; &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"Config"</span> : &#123;</span><br><span class="line">            <span class="attr">"cluster_name"</span> : <span class="string">"test_cluster"</span>,</span><br><span class="line">            <span class="attr">"stack_id"</span> : <span class="string">"HDP-2.5"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"connectors.properties"</span>,</span><br><span class="line">          <span class="attr">"tag"</span> : <span class="string">"version1502269954279"</span>,</span><br><span class="line">          <span class="attr">"version"</span> : <span class="number">11</span>,</span><br><span class="line">          <span class="attr">"properties"</span> : &#123;</span><br><span class="line">            <span class="attr">"connectors.to.add"</span> : <span class="string">"&#123;\n    'hive': ['connector.name=hive-hadoop2','hive.metastore.uri=thrift://master.hdp.test.cq:9083,thrift://slave3.hdp.test.cq:9083','hive.recursive-directories=true','hive.config.resources=/etc/hadoop/conf/core-site.xml,/etc/hadoop/conf/hdfs-site.xml']\n&#125;"</span>,</span><br><span class="line">            <span class="attr">"connectors.to.delete"</span> : <span class="string">"[]"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"properties_attributes"</span> : &#123; &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"Config"</span> : &#123;</span><br><span class="line">            <span class="attr">"cluster_name"</span> : <span class="string">"test_cluster"</span>,</span><br><span class="line">            <span class="attr">"stack_id"</span> : <span class="string">"HDP-2.5"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"jvm.config"</span>,</span><br><span class="line">          <span class="attr">"tag"</span> : <span class="string">"version1502330557517"</span>,</span><br><span class="line">          <span class="attr">"version"</span> : <span class="number">10</span>,</span><br><span class="line">          <span class="attr">"properties"</span> : &#123;</span><br><span class="line">            <span class="attr">"jvm.config"</span> : <span class="string">"-server\n-Xmx8G\n-XX:+UseG1GC\n-XX:+UseGCOverheadLimit\n-XX:+ExplicitGCInvokesConcurrent\n-XX:+HeapDumpOnOutOfMemoryError\n-XX:OnOutOfMemoryError=kill -9 %p"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"properties_attributes"</span> : &#123; &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"Config"</span> : &#123;</span><br><span class="line">            <span class="attr">"cluster_name"</span> : <span class="string">"test_cluster"</span>,</span><br><span class="line">            <span class="attr">"stack_id"</span> : <span class="string">"HDP-2.5"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"node.properties"</span>,</span><br><span class="line">          <span class="attr">"tag"</span> : <span class="string">"version1502269954279"</span>,</span><br><span class="line">          <span class="attr">"version"</span> : <span class="number">12</span>,</span><br><span class="line">          <span class="attr">"properties"</span> : &#123;</span><br><span class="line">            <span class="attr">"node.environment"</span> : <span class="string">"test"</span>,</span><br><span class="line">            <span class="attr">"plugin.config-dir"</span> : <span class="string">"/etc/presto/catalog"</span>,</span><br><span class="line">            <span class="attr">"plugin.dir"</span> : <span class="string">"/usr/lib/presto/lib/plugin"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"properties_attributes"</span> : &#123; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"createtime"</span> : <span class="number">1502330556753</span>,</span><br><span class="line">      <span class="attr">"group_id"</span> : <span class="number">-1</span>,</span><br><span class="line">      <span class="attr">"group_name"</span> : <span class="string">"Default"</span>,</span><br><span class="line">      <span class="attr">"hosts"</span> : [ ],</span><br><span class="line">      <span class="attr">"is_cluster_compatible"</span> : <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"is_current"</span> : <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"service_config_version"</span> : <span class="number">3</span>,</span><br><span class="line">      <span class="attr">"service_config_version_note"</span> : <span class="string">""</span>,</span><br><span class="line">      <span class="attr">"service_name"</span> : <span class="string">"PRESTO"</span>,</span><br><span class="line">      <span class="attr">"stack_id"</span> : <span class="string">"HDP-2.5"</span>,</span><br><span class="line">      <span class="attr">"user"</span> : <span class="string">"admin"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="升级步骤"><a href="#升级步骤" class="headerlink" title="升级步骤"></a>升级步骤</h1><h2 id="第一步：更新Ambari主控机上的Presto插件目录"><a href="#第一步：更新Ambari主控机上的Presto插件目录" class="headerlink" title="第一步：更新Ambari主控机上的Presto插件目录"></a>第一步：更新Ambari主控机上的Presto插件目录</h2><p>因为Ambari主控机上安装的Presto插件版本比较旧，且官方并没有怎么进行维护，有一些潜在的问题。这里我们需要对该Presto插件目录进行更新修复一些问题。</p>
<p>具体的修复过程，参见另一篇文章：<a href="/2017/08/09/fix-the-bug-of-the-ambari-presto-plugin-at-restart/">修复ambari presto插件在重启时的BUG</a></p>
<p>将修复过后的文件夹拷贝至Ambari的插件目录(通常位于/var/lib/ambari-server/resources/stacks/HDP/2.5/services下，2.5为当前HDP的版本信息)替换原有的PRESTO目录。</p>
<p>完成更新后，需要重启Ambari-server，这样才能让Ambari-server重新识别新的Presto插件目录。</p>
<h2 id="第二步：停止Presto服务"><a href="#第二步：停止Presto服务" class="headerlink" title="第二步：停止Presto服务"></a>第二步：停止Presto服务</h2><p>在Ambari Web管控台上停止所有的Presto实例</p>
<img src="/2017/08/09/upgrade-the-presto-component-in-ambari/BC3D34CA-5024-4F2A-8B78-4DEF99AF8A14.png">
<h2 id="第三步：在Ambari上删除Presto服务"><a href="#第三步：在Ambari上删除Presto服务" class="headerlink" title="第三步：在Ambari上删除Presto服务"></a>第三步：在Ambari上删除Presto服务</h2><p>在第二步完成后（Ambari要求删除服务组件必须是在服务停止之后）进行Presto服务的删除操作：</p>
<img src="/2017/08/09/upgrade-the-presto-component-in-ambari/2FEB8D0C-48D8-4CA8-A67E-9B8133286069.png">
<h2 id="第四步：在Presto机器上删除相关部署及部署缓存文件"><a href="#第四步：在Presto机器上删除相关部署及部署缓存文件" class="headerlink" title="第四步：在Presto机器上删除相关部署及部署缓存文件"></a>第四步：在Presto机器上删除相关部署及部署缓存文件</h2><ol>
<li>Ambari的各个slave节点Agent在安装组件前会先将组件插件目录的packages下的一些脚本文件复制到本机并缓存，以便下次不再从主控机拷贝，由于我们这里进行了插件的升级更新，所以需要手工清理slave机器的缓存目录。</li>
</ol>
<p>清理操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /var/lib/ambari-agent/cache/stacks/HDP/2.5/services/PRESTO &amp;&amp; ambari-agent restart</span><br></pre></td></tr></table></figure>
<p>上述删除缓存目录并重启ambari-agent后，ambari-agent会重新从主控机master拉取服务插件的最新文件</p>
<ol start="2">
<li>Ambari不支持删除服务的同时对安装包进行卸载，也就是说删除的只是在Ambari管理的服务的可见性，服务其实仍然安装在Slave的机器上，如果我们需要安装新包，需要先卸载旧版本组件包。当然也可以对脚本进行进一步的修改，比如先检测组件包是否已经安装，如果安装先进行卸载等等操作，这里我们暂不这样操作。</li>
</ol>
<p>卸载presto组件包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -e `rpm -qa | grep presto`</span><br></pre></td></tr></table></figure>
<h2 id="第五步：在Ambari主控机上重新添加服务并配置部署机器"><a href="#第五步：在Ambari主控机上重新添加服务并配置部署机器" class="headerlink" title="第五步：在Ambari主控机上重新添加服务并配置部署机器"></a>第五步：在Ambari主控机上重新添加服务并配置部署机器</h2><p>上面第三步中删除了Presto，这里我们可以通过主控台的Admin-&gt;Stack And Versions重新添加服务，这里我们可以看到PRESTO服务已经是我们最新添加的版本了，点击Add Service根据提示一步步进行操作</p>
<h2 id="第六步：还原配置项"><a href="#第六步：还原配置项" class="headerlink" title="第六步：还原配置项"></a>第六步：还原配置项</h2><p>在安装过程中会提示进行配置，这个时候就是需要我们还原之前备份的配置项，这点Ambari做并不好，没有什么类似配置导入的功能，所以这里需要我们手动的从备份的文件中找出各个配置项手工填入。</p>
<h2 id="第七步：根据提示完成部署"><a href="#第七步：根据提示完成部署" class="headerlink" title="第七步：根据提示完成部署"></a>第七步：根据提示完成部署</h2><p>在一切都准备就绪后，Ambari会自动进行组件的安装和配置，并会操作组件启动。</p>
<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>在安装过程中可能会出现以下问题：</p>
<ul>
<li>sudo: sorry, you must have a tty to run sudo</li>
</ul>
<p>使用不同账户，执行执行脚本时候sudo经常会碰到 sudo: sorry, you must have a tty to run sudo这个情况，其实修改一下sudo的配置就好了</p>
<p>vi /etc/sudoers (最好用visudo命令)</p>
<p>注释掉 Default requiretty 一行</p>
<p>#Default requiretty</p>
<p>意思就是sudo默认需要tty终端。注释掉就可以在后台执行了。</p>
<ul>
<li>彻底删除某个组件的服务</li>
</ul>
<p>这里有一个链接，里面主要讲怎么彻底删除组件，这个删除包括从Ambari-Server的主控台上删除，还包括从物理安装中移除，参考链接在这里：<a href="http://www.cnblogs.com/zlslch/p/6653421.html" target="_blank" rel="noopener">Ambari里如何删除某指定的服务（图文详解）</a></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>Ambari的插件机制对于更新来说并不是特别方便，它自身提供的更新机制并不适用于自定义的组件升级，需要根据上面所说的进行自定义升级操作。对于HDP发行版自带的组件升级推荐使用升级Ambari版本的方式进行，这样可以做到HDP发行版的完全兼容处理。Ambari在自定义组件升级前一定要做好数据和配置的备份工作，以应对升级失败的回滚方案。</p>
<p>最后，对于一个企业来说，数据就是它的生命，要对数据存敬畏之心，任何一次组件的操作都可能千万数据的损坏和丢失，对于企业来说都是致命性的打击。对任何一次数据组件的升级都要小心又谨慎，制定周密的升级计划和灾难预案。在实施线上操作之前，勿必先在测试环境进行验证可行性，切不可只盲目听从文档或者网上言论就贸然实施。</p>
</div><iframe src="/donate/?AliPayQR=/images/alipay.png&amp;WeChatQR=/images/wechat.png&amp;GitHub=null&amp;BTCQR=null&amp;BTCKEY=null&amp;PayPal=null" style="overflow-x:hidden; overflow-y:hidden; border:0xp none #fff; min-height:240px; width:100%;" frameborder="0" scrolling="no"></iframe><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://www.lpnote.com/2017/08/09/upgrade-the-presto-component-in-ambari/" data-id="cjs2ys7lc009kazp5ux65qpn9" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACuklEQVR42u3awW7rMAwEwPz/T+cB7xrY3aXMNofxKWhVR6MCIkHy9Yqf9//n/uefn69+e/WezzXvj+e18eDh4eGNtn713K9JNpEcwWzN/a7w8PDwtnn5pZ9c9Mkb8m/JwwweHh7et/FOQsLJMc0OCw8PD+97eLOCRXJAyd/i4eHhfQ8v2UQeJPIjaL93sdaCh4eHF/NO0tm/+rzY38PDw8M76Krnl2+S8uYhoU3NL9+Ah4eHt8DL0+Uk/Z2NYbVNr3q0Cw8PD+9RXn4dJ69riwV5mJmVlfHw8PD2eC2jLdE+e1hFYwwPDw9vjXeSQM/aWm0qP6vZ4uHh4W3w7hfN0tkksU4OZWV0AA8PD++Y1za36tM6SIjbJB4PDw/vd3iz9n87UpCk4HlwGibfeHh4eL/IS9pXswGCfGggf/MP8xF4eHh4x7wkDOTJbr5mhqxDBR4eHt4C74F4cjwE0La46qYXHh4e3qO8JF1uG2PnI1NtaeNyDR4eHt4y79nxqXa4Ki+CFG/Gw8PDW+Dl6el5UbUNFXmTLPkn4eHh4T3Lyy/fduwpL17Mjjg6FDw8PLxHeXlRNS/Unm/3fDALDw8Pb4/XllnbgkJyiR8NBMzCAx4eHt4Br21oJeWDE3CysihG4OHh4a3x8vZVmy4nmzgZHRhGPDw8PLzjMm4+2doGgLywO2PcfxceHh7eBi/Z6OzibosOKyOweHh4eAu8tsWVN71m13oeovLxLzw8PLxnee/yOW+YzYZfh403PDw8vAVe/tTNp7Lc0IaiPEHHw8PD2+C1weAecB4GZkXkqMuHh4eH9yivDQZFneO4RJuHrsvAgIeHh/envNl2Z2Ejn4B4LDDg4eHhPcrLr+Y8PJy0yorOHh4eHt4Cr2165aRnMfXh4uHh4S3w2gZYUgJIChnt0FU74oCHh4e3wPsHR1TvZPZNQLUAAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/大数据/">大数据</a><a href="/tags/presto/">presto</a><a href="/tags/ambari/">ambari</a></div><div class="post-nav"><a class="pre" href="/2017/08/13/start-of-DIY-configcenter/">DIY配置中心系列（一）：起步</a><a class="next" href="/2017/08/08/fix-the-bug-of-the-ambari-presto-plugin-at-restart/">修复ambari presto插件在重启时的BUG</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var path = "2017/08/09/upgrade-the-presto-component-in-ambari/"
var paths = path.split("/")
var lastPathLen = paths[paths.length-1].length
var finalPath = paths[paths.length-1]
if(lastPathLen == 0) {
   finalPath = paths[paths.length-2]
}
var p = finalPath.length < 50 ? finalPath : finalPath.substring(0,49)
var gitment = new Gitment({
  id: p,
  owner: 'icanfly',
  repo: 'blog_comments',
  oauth: {
    client_id: '9d8f7a953f32b2942597',
    client_secret: 'efbc1217c60b17a9ceae6b2bbc6885dc17c51ac7',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://www.lpnote.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/">leetcode</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/原创文章/">原创文章</a><span class="category-list-count">38</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/原创文章/问题记录/">问题记录</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/翻译文章/">翻译文章</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载文章/">转载文章</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/问题记录/">问题记录</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/问题解析/" style="font-size: 15px;">问题解析</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/apache/" style="font-size: 15px;">apache</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/fastjson/" style="font-size: 15px;">fastjson</a> <a href="/tags/ranger/" style="font-size: 15px;">ranger</a> <a href="/tags/hdfs/" style="font-size: 15px;">hdfs</a> <a href="/tags/大数据/" style="font-size: 15px;">大数据</a> <a href="/tags/最佳实践/" style="font-size: 15px;">最佳实践</a> <a href="/tags/hortonworks/" style="font-size: 15px;">hortonworks</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/bug/" style="font-size: 15px;">bug</a> <a href="/tags/groovy/" style="font-size: 15px;">groovy</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/配置中心/" style="font-size: 15px;">配置中心</a> <a href="/tags/DIY/" style="font-size: 15px;">DIY</a> <a href="/tags/HIVE/" style="font-size: 15px;">HIVE</a> <a href="/tags/搜索引擎/" style="font-size: 15px;">搜索引擎</a> <a href="/tags/lucene/" style="font-size: 15px;">lucene</a> <a href="/tags/elasticsearch/" style="font-size: 15px;">elasticsearch</a> <a href="/tags/IDE/" style="font-size: 15px;">IDE</a> <a href="/tags/IDEA/" style="font-size: 15px;">IDEA</a> <a href="/tags/json/" style="font-size: 15px;">json</a> <a href="/tags/jackson/" style="font-size: 15px;">jackson</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/并发/" style="font-size: 15px;">并发</a> <a href="/tags/源码解读/" style="font-size: 15px;">源码解读</a> <a href="/tags/基础问题/" style="font-size: 15px;">基础问题</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/leetcode/" style="font-size: 15px;">leetcode</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/centos/" style="font-size: 15px;">centos</a> <a href="/tags/vim/" style="font-size: 15px;">vim</a> <a href="/tags/mac/" style="font-size: 15px;">mac</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/Mybatis/" style="font-size: 15px;">Mybatis</a> <a href="/tags/ORM/" style="font-size: 15px;">ORM</a> <a href="/tags/负载均衡/" style="font-size: 15px;">负载均衡</a> <a href="/tags/guava/" style="font-size: 15px;">guava</a> <a href="/tags/踩坑/" style="font-size: 15px;">踩坑</a> <a href="/tags/session/" style="font-size: 15px;">session</a> <a href="/tags/druid/" style="font-size: 15px;">druid</a> <a href="/tags/rpm/" style="font-size: 15px;">rpm</a> <a href="/tags/tomcat/" style="font-size: 15px;">tomcat</a> <a href="/tags/jetty/" style="font-size: 15px;">jetty</a> <a href="/tags/gc/" style="font-size: 15px;">gc</a> <a href="/tags/presto/" style="font-size: 15px;">presto</a> <a href="/tags/OOM/" style="font-size: 15px;">OOM</a> <a href="/tags/GC/" style="font-size: 15px;">GC</a> <a href="/tags/SVN/" style="font-size: 15px;">SVN</a> <a href="/tags/版本控制/" style="font-size: 15px;">版本控制</a> <a href="/tags/VCS/" style="font-size: 15px;">VCS</a> <a href="/tags/分支管理/" style="font-size: 15px;">分支管理</a> <a href="/tags/virtualbox/" style="font-size: 15px;">virtualbox</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/timewheels/" style="font-size: 15px;">timewheels</a> <a href="/tags/timer/" style="font-size: 15px;">timer</a> <a href="/tags/yarn/" style="font-size: 15px;">yarn</a> <a href="/tags/SpringCloud/" style="font-size: 15px;">SpringCloud</a> <a href="/tags/微服务/" style="font-size: 15px;">微服务</a> <a href="/tags/metrics/" style="font-size: 15px;">metrics</a> <a href="/tags/ambari/" style="font-size: 15px;">ambari</a> <a href="/tags/参与开源/" style="font-size: 15px;">参与开源</a> <a href="/tags/timewheel/" style="font-size: 15px;">timewheel</a> <a href="/tags/skywalking/" style="font-size: 15px;">skywalking</a> <a href="/tags/apm/" style="font-size: 15px;">apm</a> <a href="/tags/SQL/" style="font-size: 15px;">SQL</a> <a href="/tags/solr/" style="font-size: 15px;">solr</a> <a href="/tags/rocketmq/" style="font-size: 15px;">rocketmq</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/dubbo/" style="font-size: 15px;">dubbo</a> <a href="/tags/问题分析/" style="font-size: 15px;">问题分析</a> <a href="/tags/github/" style="font-size: 15px;">github</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/02/13/ignore_above-in-elasticsearch/">Elasticsearch中ignore_above的作用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/02/java-concurrent-striped64/">java并发之Striped64解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/31/memory-leak-analysis-for-skywalking/">一次Skywalking内存泄露的原因分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/31/write-combining/">合并写(write combining)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/31/false-sharing/">伪共享(False Sharing)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/08/groovy-expr-usage/">groovy-expr-usage</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/08/jackson-ctrl-char-problem-resovle/">jackson-ctrl-char-problem-resovle</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/04/solve-a-disk-warning-illusion-caused-by-rocketmq/">solve-a-disk-warning-illusion-caused-by-rocketmq</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/30/hexoclient-usage/">hexoclient-usage</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/23/customize-instance-id-with-consul-service-registry/">定制springcloud服务注册到consul中的instanceId</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">LP's Notes.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo. </a><a rel="nofollow" target="_blank" href="https://coding.net">Hosted by Coding Pages.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>