<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="侠客行舟|技术博客|Java|分布式|架构|大数据"><title>修复ambari presto插件在重启时的BUG | LP's Notes</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">修复ambari presto插件在重启时的BUG</h1><a id="logo" href="/.">LP's Notes</a><p class="description">侠客行舟 不进则退</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">修复ambari presto插件在重启时的BUG</h1><div class="post-meta">Aug 8, 2017<span> | </span><span class="category"><a href="/categories/原创文章/">原创文章</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#问题"><span class="toc-number">2.</span> <span class="toc-text">问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#问题1：Presto状态检测与Ambari状态检测的冲突问题"><span class="toc-number">2.1.</span> <span class="toc-text">问题1：Presto状态检测与Ambari状态检测的冲突问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#问题1解决方案"><span class="toc-number">2.2.</span> <span class="toc-text">问题1解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#问题2：脚本调用Python-Http时传入参数类型不匹配"><span class="toc-number">2.3.</span> <span class="toc-text">问题2：脚本调用Python Http时传入参数类型不匹配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#问题2方案：进行类型转换"><span class="toc-number">2.4.</span> <span class="toc-text">问题2方案：进行类型转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#问题3：重启冒烟测试时Presto-Coodinator拒绝连接"><span class="toc-number">2.5.</span> <span class="toc-text">问题3：重启冒烟测试时Presto Coodinator拒绝连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#问题3方案：增加延时时间，等待节点启动完毕"><span class="toc-number">2.6.</span> <span class="toc-text">问题3方案：增加延时时间，等待节点启动完毕</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-number">3.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>随着商业数据的不断累积与爆发式增长，传统的数据存储已经不能很好的满足日益增长的数据系统需要，传统的通过关系型数据进行数据获取的方式正在随着数据量的快速增长而出现了瓶颈，随着以Hadoop为代表的大数据平台的出现，有效解决了数据高速增长带来的数据存储和管理问题。现在大数据平台基本上每家公司都发展中长期必备的基础设施，公司基础数据平台使用的Hortonworks提供的大数据平台发行版，使用ambari进行数据平台的管理工作。前段时间大数据平台引入的Presto数据查询引擎作为即席查询工具，并使用ambari对presto的插件支持进行管理。</p>
<p>Ambari是由Hortonworks公司出品一款大数据平台管理软件，它将大数据平台所需要的各种组件进行统一管理，并提供大数据平台主机管理及各组件的安装制定、配置、启停、监控等一系列非常方便的功能。同时它也支持用户自定义组件插件，提供了良好的扩展能力。</p>
<a id="more"></a>
<img src="/2017/08/08/fix-the-bug-of-the-ambari-presto-plugin-at-restart/432E0D4D-7C6B-4374-8FCB-AE10016546D1.png">
<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>Presto官方为Ambari提供了一个presto的插件，插件地址：<a href="https://github.com/prestodb/ambari-presto-service" target="_blank" rel="noopener">Ambari-Presto-Service</a>，该插件遵循Ambari的插件体系规范，可以集成到Ambari提供Presto的管理功能。</p>
<p>官方提供了一个Presto的Ambari插件集成<a href="https://prestodb.io/ambari-presto-service/getting-started.html#" target="_blank" rel="noopener">文档地址</a>，指明了如何将插件集成到Ambari中，该文档有点旧，只能是对照着大致看下，帮助理解。</p>
<p>官方的Presto存在在Ambari界面上对Presto进行重启会失败的问题,该问题由几个小问题组成，我都对其进行了修复。</p>
<blockquote>
<p>多提一句的是：官方对于这个Ambari的插件的维护似乎并不上心，该插件最新的更新时间已经是7个月以前，而且最新的改动只是一个微小改动。所以，在官方网站上并不能找到相关的解决办法及修复，所有的所有只能是靠自己去理解Ambari插件的运行原理并根据思考去尝试修复。</p>
</blockquote>
<h2 id="问题1：Presto状态检测与Ambari状态检测的冲突问题"><a href="#问题1：Presto状态检测与Ambari状态检测的冲突问题" class="headerlink" title="问题1：Presto状态检测与Ambari状态检测的冲突问题"></a>问题1：Presto状态检测与Ambari状态检测的冲突问题</h2><p>在Ambari上进行Restart操作时，Ambari主控台实际上是依次调用了插件的stop/status/start函数，stop调用是为了让组件停止运行，而status调用是检测组件是否正确意义上停止运行，确保后续的start调用不会存在问题。对于Presto插件来说，节点为了coordinator和worker两种类型，但是获取他们的状态都通过Presto <code>launcher.py</code>脚本文件的status函数，该函数返回节点的状态：0表示正在运行；3表示已停止运行。而Presto插件脚本文件<a href="https://github.com/prestodb/ambari-presto-service/blob/master/package/scripts/presto_coordinator.py" target="_blank" rel="noopener">presto_coordinator.py</a>在调用status时使用的Execute类，该类为Ambari内部工具类，使用就是执行你传入的脚本内容，并在你的脚本内容执行返回码不为0时抛出错误异常。</p>
<p>presto_coordinator.py脚本函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">status</span><span class="params">(self, env)</span>:</span></span><br><span class="line">        <span class="keyword">from</span> params <span class="keyword">import</span> daemon_control_script</span><br><span class="line">        Execute(<span class="string">'&#123;0&#125; status'</span>.format(daemon_control_script))</span><br></pre></td></tr></table></figure>
<p>现在问题就出现在这里，Ambari主控台调用presto_coordinator.py脚本的status函数时，Execute内部实现规定脚本正常执行完成时应该返回0，返回其它值将导致Execute抛出ExecutioinFailed异常。Execute实际是调用了Presto安装目录bin/launcher的status函数（该函数返回了状态码3），导致Execute收到了一个不被期望的返回值3，然后它抛出了一个ExecutionFailed异常，最终导致Ambari重启Presto异常中断。</p>
<p>  <code>/usr/lib/python2.6/site-packages/resource_management/libraries/script/script.py</code>文件内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">restart</span><span class="params">(self, env)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Default implementation of restart command is to call stop and start methods</span></span><br><span class="line"><span class="string">    Feel free to override restart() method with your implementation.</span></span><br><span class="line"><span class="string">    For client components we call install</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    //此处省略N行</span><br><span class="line"></span><br><span class="line">    service_name = config[<span class="string">'serviceName'</span>] <span class="keyword">if</span> config <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">and</span> <span class="string">'serviceName'</span> <span class="keyword">in</span> config <span class="keyword">else</span> <span class="keyword">None</span></span><br><span class="line">      <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">#TODO Once the logic for pid is available from Ranger and Ranger KMS code, will remove the below if block.</span></span><br><span class="line">        services_to_skip = [<span class="string">'RANGER'</span>, <span class="string">'RANGER_KMS'</span>]</span><br><span class="line">        <span class="keyword">if</span> service_name <span class="keyword">in</span> services_to_skip:</span><br><span class="line">          Logger.info(<span class="string">'Temporarily skipping status check for &#123;0&#125; service only.'</span>.format(service_name))</span><br><span class="line">        <span class="keyword">elif</span> is_stack_upgrade:</span><br><span class="line">          Logger.info(<span class="string">'Skipping status check for &#123;0&#125; service during upgrade'</span>.format(service_name))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">          self.status(env)</span><br><span class="line">          <span class="keyword">raise</span> Fail(<span class="string">"Stop command finished but process keep running."</span>)</span><br><span class="line">      <span class="keyword">except</span> ComponentIsNotRunning <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span>  <span class="comment"># expected</span></span><br><span class="line">      <span class="keyword">except</span> ClientComponentHasNoStatus <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span>  <span class="comment"># expected</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   //此处省略N行</span><br></pre></td></tr></table></figure>
<p>从上面的代码可以看到调用<code>self.status(env)</code>后如果不抛出异常，则后面的<code>raise Fail(&quot;Stop command finished but process keep running.&quot;)</code>就会被执行，导致Ambari流程中断：</p>
<img src="/2017/08/08/fix-the-bug-of-the-ambari-presto-plugin-at-restart/BD998F8D-234F-4D82-890B-910A6F38E36D.png">
<h2 id="问题1解决方案"><a href="#问题1解决方案" class="headerlink" title="问题1解决方案"></a>问题1解决方案</h2><p>对于这种不兼容情况，需要捕获异常并进行处理，在节点未运行的情况下（返回码3）给予Ambari主控台正确的信息：</p>
<p>修改后的presto_coordinator.py脚本函数<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">status</span><span class="params">(self, env)</span>:</span></span><br><span class="line">        <span class="keyword">from</span> params <span class="keyword">import</span> daemon_control_script</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            Execute(<span class="string">'&#123;0&#125; status'</span>.format(daemon_control_script))</span><br><span class="line">        <span class="keyword">except</span> ExecutionFailed <span class="keyword">as</span> ef:</span><br><span class="line">            <span class="keyword">if</span> ef.code == <span class="number">3</span>: <span class="comment">#等于3表示Presto节点未运行</span></span><br><span class="line">                <span class="comment">#这里只能抛出这个异常，这个异常在Ambari的框架中会被捕获并被正确理解和处理</span></span><br><span class="line">                <span class="keyword">raise</span> ComponentIsNotRunning(<span class="string">"ComponentIsNotRunning"</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> ef</span><br></pre></td></tr></table></figure></p>
<h2 id="问题2：脚本调用Python-Http时传入参数类型不匹配"><a href="#问题2：脚本调用Python-Http时传入参数类型不匹配" class="headerlink" title="问题2：脚本调用Python Http时传入参数类型不匹配"></a>问题2：脚本调用Python Http时传入参数类型不匹配</h2><img src="/2017/08/08/fix-the-bug-of-the-ambari-presto-plugin-at-restart/7143981D-4C64-41CD-9288-11283C297726.png">
<p>原因在于presto_coordinator.py脚本中start的时候传入构建PrestoClient对象的port属性并非string类型或者int类型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self, env)</span>:</span></span><br><span class="line">        <span class="keyword">from</span> params <span class="keyword">import</span> daemon_control_script, config_properties, \</span><br><span class="line">            host_info</span><br><span class="line">        self.configure(env)</span><br><span class="line">        Execute(<span class="string">'&#123;0&#125; start'</span>.format(daemon_control_script))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'presto_worker_hosts'</span> <span class="keyword">in</span> host_info.keys():</span><br><span class="line">            all_hosts = host_info[<span class="string">'presto_worker_hosts'</span>] + \</span><br><span class="line">                host_info[<span class="string">'presto_coordinator_hosts'</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            all_hosts = host_info[<span class="string">'presto_coordinator_hosts'</span>]</span><br><span class="line">        smoketest_presto(PrestoClient(<span class="string">'localhost'</span>,<span class="string">'root'</span>,config_properties[<span class="string">'http-server.http.port'</span>]),all_hosts)</span><br></pre></td></tr></table></figure>
<h2 id="问题2方案：进行类型转换"><a href="#问题2方案：进行类型转换" class="headerlink" title="问题2方案：进行类型转换"></a>问题2方案：进行类型转换</h2><p>修改下该函数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self, env)</span>:</span></span><br><span class="line">        <span class="keyword">from</span> params <span class="keyword">import</span> daemon_control_script, config_properties, \</span><br><span class="line">            host_info</span><br><span class="line">        self.configure(env)</span><br><span class="line">        Execute(<span class="string">'&#123;0&#125; start'</span>.format(daemon_control_script))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'presto_worker_hosts'</span> <span class="keyword">in</span> host_info.keys():</span><br><span class="line">            all_hosts = host_info[<span class="string">'presto_worker_hosts'</span>] + \</span><br><span class="line">                host_info[<span class="string">'presto_coordinator_hosts'</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            all_hosts = host_info[<span class="string">'presto_coordinator_hosts'</span>]</span><br><span class="line">        smoketest_presto(PrestoClient(<span class="string">'localhost'</span>,<span class="string">'root'</span>,int(config_properties[<span class="string">'http-server.http.port'</span>]),all_hosts)</span><br></pre></td></tr></table></figure></p>
<p>解决该问题！</p>
<h2 id="问题3：重启冒烟测试时Presto-Coodinator拒绝连接"><a href="#问题3：重启冒烟测试时Presto-Coodinator拒绝连接" class="headerlink" title="问题3：重启冒烟测试时Presto Coodinator拒绝连接"></a>问题3：重启冒烟测试时Presto Coodinator拒绝连接</h2><img src="/2017/08/08/fix-the-bug-of-the-ambari-presto-plugin-at-restart/7D4B838D-E9C6-4264-B335-BB24721ED642.png">
<p>原因在于：</p>
<img src="/2017/08/08/fix-the-bug-of-the-ambari-presto-plugin-at-restart/136AD971-81E0-41E8-8EBD-9CA9FD244BA5.png">
<p>在Presto Coordinator节点刚刚开始启动的情况下就进行了冒烟测试，这个启动并未保证Coordinator节点启动完成</p>
<h2 id="问题3方案：增加延时时间，等待节点启动完毕"><a href="#问题3方案：增加延时时间，等待节点启动完毕" class="headerlink" title="问题3方案：增加延时时间，等待节点启动完毕"></a>问题3方案：增加延时时间，等待节点启动完毕</h2><img src="/2017/08/08/fix-the-bug-of-the-ambari-presto-plugin-at-restart/9E32B640-4897-4BA3-A557-1D4D77F7914D.png">
<p>该方案只是延时的等待时间，在这个延时时间内一般情况下节点都会启动完成并能成功冒烟测试成功。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>通过这次的问题排查，对于Ambari的插件体系也有一个大致的认识，也增强了自己问题排查、分析、解决问题的能力。对于Ambari Presto插件的修改我也会积极反馈至开源社区，提交相关ISSUE和PR，希望能得到社区的接纳。^_^</p>
<p>提交的社区ISSUE: <a href="https://github.com/prestodb/ambari-presto-service/issues/28" target="_blank" rel="noopener">ISSUE-28</a></p>
<p>我的修复PR: <a href="https://github.com/prestodb/ambari-presto-service/pull/29" target="_blank" rel="noopener">PULL-29</a></p>
</div><iframe src="/donate/?AliPayQR=/images/alipay.png&amp;WeChatQR=/images/wechat.png&amp;GitHub=null&amp;BTCQR=null&amp;BTCKEY=null&amp;PayPal=null" style="overflow-x:hidden; overflow-y:hidden; border:0xp none #fff; min-height:240px; width:100%;" frameborder="0" scrolling="no"></iframe><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://www.lpnote.com/2017/08/08/fix-the-bug-of-the-ambari-presto-plugin-at-restart/" data-id="cjs2ys7k5008eazp5mpoxrmox" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACqklEQVR42u3aQU7DQAwF0N7/0iCxQoIm3/a4FOllVUGTzJvF2LX9eMTXx9f1/fP369nfk7t+/vf6vY+NCw8PD6+19GRxz17zjJFvUAJOnvDLFuDh4eGt8ZJgUA0eyb3JduTPxMPDw3s33vXxXQ0nvTCAh4eH9794OTt5cnW5eHh4eO/Gy4uw1cO9ujWTkjEeHh7ea3i9Btjffl7v7+Hh4eG1uuq9UYAkMOQNsMlq8fDw8DZ4ebqclBh6Bd+8EFwtZODh4eFt8DaO7OqowaT0cJP04+Hh4S3zrl8wakHFT+gVkW+SaTw8PLyjvOvXVNtR1bGtCaNQ2MXDw8Nb4FWT4N64QG9EYLJZeHh4eHu8+WBTXtitDnJNysR4eHh4G7yzR3MvBa9uWb5CPDw8vA1eXmxNkul8RKAK6wUPPDw8vA1e8vM+P6bnsLxoGxWU8fDw8JZ5yXhTrxmWY6oDBzfrwcPDw1vjVdta84JsXjgeDV3h4eHhLfB65ddTo1F5GaIaGPDw8PD2eNW206g23BrhShLr8i8GPDw8vAHvVILba+dXG2DVYQU8PDy8Pd6p3Lx6oM/DUvkXAx4eHt5R3uS2SSG4OnBQTbXx8PDwzvJ6afGkbVZtg1VTbTw8PLxtXp5MV5teSYM/P/onm4WHh4e3wSt/qVViqD5tXtrAw8PD2+Plza1qSaIaEvKjv1BrwcPDw1vj9dLZ3iBUnqY/ihceHh7eNu9sI6qX/lbLuIWggoeHh7fAm8STjfmFhD0peeDh4eGd4lWDQV4UyJPpZJuagQEPDw9vjVdNiJMXTL7TC103VWo8PDy8N+NVhwDmAwTl0QE8PDy8l/N6qXav8Z8PENwUcPHw8PDWeL1kN1n0qfbYqLmFh4eHd5Q3GQLYa5XlQegAHg8PDy/lfQJL8gMn2bHxzAAAAABJRU5ErkJggg==">分享</a><div class="tags"><a href="/tags/大数据/">大数据</a><a href="/tags/bug/">bug</a><a href="/tags/presto/">presto</a><a href="/tags/ambari/">ambari</a><a href="/tags/参与开源/">参与开源</a></div><div class="post-nav"><a class="pre" href="/2017/08/09/upgrade-the-presto-component-in-ambari/">升级Ambari中的Presto组件</a><a class="next" href="/2017/08/07/troubleshooting-of-outofmemory-in-presto/">Presto内存溢出(OutOfMemory)问题排查</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var path = "2017/08/08/fix-the-bug-of-the-ambari-presto-plugin-at-restart/"
var paths = path.split("/")
var lastPathLen = paths[paths.length-1].length
var finalPath = paths[paths.length-1]
if(lastPathLen == 0) {
   finalPath = paths[paths.length-2]
}
var p = finalPath.length < 50 ? finalPath : finalPath.substring(0,49)
var gitment = new Gitment({
  id: p,
  owner: 'icanfly',
  repo: 'blog_comments',
  oauth: {
    client_id: '9d8f7a953f32b2942597',
    client_secret: 'efbc1217c60b17a9ceae6b2bbc6885dc17c51ac7',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://www.lpnote.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/">leetcode</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/原创文章/">原创文章</a><span class="category-list-count">38</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/原创文章/问题记录/">问题记录</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/翻译文章/">翻译文章</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载文章/">转载文章</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/问题记录/">问题记录</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/问题解析/" style="font-size: 15px;">问题解析</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/apache/" style="font-size: 15px;">apache</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/fastjson/" style="font-size: 15px;">fastjson</a> <a href="/tags/ranger/" style="font-size: 15px;">ranger</a> <a href="/tags/hdfs/" style="font-size: 15px;">hdfs</a> <a href="/tags/大数据/" style="font-size: 15px;">大数据</a> <a href="/tags/最佳实践/" style="font-size: 15px;">最佳实践</a> <a href="/tags/hortonworks/" style="font-size: 15px;">hortonworks</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/bug/" style="font-size: 15px;">bug</a> <a href="/tags/groovy/" style="font-size: 15px;">groovy</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/配置中心/" style="font-size: 15px;">配置中心</a> <a href="/tags/DIY/" style="font-size: 15px;">DIY</a> <a href="/tags/HIVE/" style="font-size: 15px;">HIVE</a> <a href="/tags/搜索引擎/" style="font-size: 15px;">搜索引擎</a> <a href="/tags/lucene/" style="font-size: 15px;">lucene</a> <a href="/tags/elasticsearch/" style="font-size: 15px;">elasticsearch</a> <a href="/tags/IDE/" style="font-size: 15px;">IDE</a> <a href="/tags/IDEA/" style="font-size: 15px;">IDEA</a> <a href="/tags/json/" style="font-size: 15px;">json</a> <a href="/tags/jackson/" style="font-size: 15px;">jackson</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/并发/" style="font-size: 15px;">并发</a> <a href="/tags/源码解读/" style="font-size: 15px;">源码解读</a> <a href="/tags/基础问题/" style="font-size: 15px;">基础问题</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/leetcode/" style="font-size: 15px;">leetcode</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/centos/" style="font-size: 15px;">centos</a> <a href="/tags/vim/" style="font-size: 15px;">vim</a> <a href="/tags/mac/" style="font-size: 15px;">mac</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/Mybatis/" style="font-size: 15px;">Mybatis</a> <a href="/tags/ORM/" style="font-size: 15px;">ORM</a> <a href="/tags/负载均衡/" style="font-size: 15px;">负载均衡</a> <a href="/tags/guava/" style="font-size: 15px;">guava</a> <a href="/tags/踩坑/" style="font-size: 15px;">踩坑</a> <a href="/tags/session/" style="font-size: 15px;">session</a> <a href="/tags/druid/" style="font-size: 15px;">druid</a> <a href="/tags/rpm/" style="font-size: 15px;">rpm</a> <a href="/tags/tomcat/" style="font-size: 15px;">tomcat</a> <a href="/tags/jetty/" style="font-size: 15px;">jetty</a> <a href="/tags/gc/" style="font-size: 15px;">gc</a> <a href="/tags/presto/" style="font-size: 15px;">presto</a> <a href="/tags/OOM/" style="font-size: 15px;">OOM</a> <a href="/tags/GC/" style="font-size: 15px;">GC</a> <a href="/tags/SVN/" style="font-size: 15px;">SVN</a> <a href="/tags/版本控制/" style="font-size: 15px;">版本控制</a> <a href="/tags/VCS/" style="font-size: 15px;">VCS</a> <a href="/tags/分支管理/" style="font-size: 15px;">分支管理</a> <a href="/tags/virtualbox/" style="font-size: 15px;">virtualbox</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/timewheels/" style="font-size: 15px;">timewheels</a> <a href="/tags/timer/" style="font-size: 15px;">timer</a> <a href="/tags/yarn/" style="font-size: 15px;">yarn</a> <a href="/tags/SpringCloud/" style="font-size: 15px;">SpringCloud</a> <a href="/tags/微服务/" style="font-size: 15px;">微服务</a> <a href="/tags/metrics/" style="font-size: 15px;">metrics</a> <a href="/tags/ambari/" style="font-size: 15px;">ambari</a> <a href="/tags/参与开源/" style="font-size: 15px;">参与开源</a> <a href="/tags/timewheel/" style="font-size: 15px;">timewheel</a> <a href="/tags/skywalking/" style="font-size: 15px;">skywalking</a> <a href="/tags/apm/" style="font-size: 15px;">apm</a> <a href="/tags/SQL/" style="font-size: 15px;">SQL</a> <a href="/tags/solr/" style="font-size: 15px;">solr</a> <a href="/tags/rocketmq/" style="font-size: 15px;">rocketmq</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/dubbo/" style="font-size: 15px;">dubbo</a> <a href="/tags/问题分析/" style="font-size: 15px;">问题分析</a> <a href="/tags/github/" style="font-size: 15px;">github</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/02/13/ignore_above-in-elasticsearch/">Elasticsearch中ignore_above的作用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/02/java-concurrent-striped64/">java并发之Striped64解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/31/memory-leak-analysis-for-skywalking/">一次Skywalking内存泄露的原因分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/31/write-combining/">合并写(write combining)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/31/false-sharing/">伪共享(False Sharing)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/08/groovy-expr-usage/">groovy-expr-usage</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/08/jackson-ctrl-char-problem-resovle/">jackson-ctrl-char-problem-resovle</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/04/solve-a-disk-warning-illusion-caused-by-rocketmq/">solve-a-disk-warning-illusion-caused-by-rocketmq</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/30/hexoclient-usage/">hexoclient-usage</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/23/customize-instance-id-with-consul-service-registry/">定制springcloud服务注册到consul中的instanceId</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">LP's Notes.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo. </a><a rel="nofollow" target="_blank" href="https://coding.net">Hosted by Coding Pages.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>