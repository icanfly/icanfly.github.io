<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="侠客行舟|技术博客|Java|分布式|架构|大数据"><title>Ranger自定义插件开发 | LP's Notes</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Ranger自定义插件开发</h1><a id="logo" href="/.">LP's Notes</a><p class="description">侠客行舟 不进则退</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Ranger自定义插件开发</h1><div class="post-meta">Jan 23, 2017<span> | </span><span class="category"><a href="/categories/翻译文章/">翻译文章</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Ranger简介"><span class="toc-number">1.</span> <span class="toc-text">Ranger简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#创建自定义授权插件"><span class="toc-number">2.</span> <span class="toc-text">创建自定义授权插件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#定义服务类型-Service-type"><span class="toc-number">2.1.</span> <span class="toc-text">定义服务类型(Service-type)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ranger授权插件开发"><span class="toc-number">2.2.</span> <span class="toc-text">Ranger授权插件开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#服务初始化"><span class="toc-number">2.2.1.</span> <span class="toc-text">服务初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#资源授权访问"><span class="toc-number">2.2.2.</span> <span class="toc-text">资源授权访问</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#资源查找"><span class="toc-number">2.2.3.</span> <span class="toc-text">资源查找</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装插件到服务中"><span class="toc-number">2.3.</span> <span class="toc-text">安装插件到服务中</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#服务类型"><span class="toc-number">3.</span> <span class="toc-text">服务类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#服务类型定义"><span class="toc-number">3.1.</span> <span class="toc-text">服务类型定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#例子-YARN服务类型定义"><span class="toc-number">3.2.</span> <span class="toc-text">例子-YARN服务类型定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注册服务类型"><span class="toc-number">3.3.</span> <span class="toc-text">注册服务类型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ranger插件开发"><span class="toc-number">4.</span> <span class="toc-text">Ranger插件开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Ranger-Authorizer"><span class="toc-number">4.1.</span> <span class="toc-text">Ranger Authorizer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#资源查找-1"><span class="toc-number">4.2.</span> <span class="toc-text">资源查找</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安装和配置插件"><span class="toc-number">5.</span> <span class="toc-text">安装和配置插件</span></a></li></ol></div></div><div class="post-content"><blockquote>
<p>英文链接：<a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=53741207" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=53741207</a></p>
</blockquote>
<h1 id="Ranger简介"><a href="#Ranger简介" class="headerlink" title="Ranger简介"></a>Ranger简介</h1><p>Apache Ranger为Hadoop体系提供了统一的安全体系，包括细致的访问控制和统一的审计。 Apache Ranger 0.4版本为很多服务提供了授权和审核，这些服务包括： HDFS, HBase, Hive, Knox和Storm。如果要添加更多的服务支持就需要多个模块的修改，包括UI，API，数据库schema等等。</p>
<p>Apache Ranger 0.5版本支持了一个统一的模型来更好地支持新组件的接入，而这些接入并不需要改变Ranger的代码。这篇文章主要阐述了自定义Ranger组件的编程模型以及步骤。</p>
<h1 id="创建自定义授权插件"><a href="#创建自定义授权插件" class="headerlink" title="创建自定义授权插件"></a>创建自定义授权插件</h1><p>这节将提供的是一个创建授权插件的高阶视图。 更多的每一步细节都会在后面的步骤中说明。</p>
<h2 id="定义服务类型-Service-type"><a href="#定义服务类型-Service-type" class="headerlink" title="定义服务类型(Service-type)"></a>定义服务类型(Service-type)</h2><ol>
<li><p>创建一个JSON格式的文件，包含以下内容：</p>
<ul>
<li>资源,比如：database,table,column等</li>
<li>访问类型,比如：select, update, create, drop等</li>
<li>连接服务的配置,比如：JDBC URL,JDBC driver,credentials等</li>
</ul>
</li>
<li><p>加载JSON文件到Ranger中</p>
</li>
</ol>
<a id="more"></a>
<h2 id="Ranger授权插件开发"><a href="#Ranger授权插件开发" class="headerlink" title="Ranger授权插件开发"></a>Ranger授权插件开发</h2><h3 id="服务初始化"><a href="#服务初始化" class="headerlink" title="服务初始化"></a>服务初始化</h3><ol>
<li>创建一个静态的（或者全局的）<code>RangerBasePlugin</code>实例（或者继承至它的一个实例），并提供一个方便后面授权使用的引用</li>
<li>调用该实例的<code>init()</code>方法。这个步骤将会初始化policy-engine，它会从Ranger Admin拉取安全策略，并启动一个后台线程用于周期性的从Ranger Admin更新安全策略。</li>
<li>在插件实例中注册一个审计处理器，比如：<code>RangerDefaultAuditHandler</code>。 插件将会使用这个审计处理器生成资源访问的审计日志。</li>
</ol>
<h3 id="资源授权访问"><a href="#资源授权访问" class="headerlink" title="资源授权访问"></a>资源授权访问</h3><ol>
<li>创建一个<code>RangerAccessRequest</code>实现的实例，该实例拥有资源、访问类型、用户等需要被授权的细节逻辑，这个实现类可以参考<code>RangerAccessRequestImpl</code>。</li>
<li>调用前面创建的插件实例方法<code>isAccessAllowed()</code>。</li>
<li>根据返回的结果决定允许还是拒绝操作。</li>
</ol>
<h3 id="资源查找"><a href="#资源查找" class="headerlink" title="资源查找"></a>资源查找</h3><ol>
<li>继承<code>RangerBaseService</code>类，实现<code>lookupResource()</code>和<code>validateConfig()</code>方法。</li>
<li>为这个类提供一个在服务定义中的名字。</li>
<li>将包含该实现的类的类库（jar包文件）以及该类库依赖的其它类库拷贝到Ranger Admin的<code>ranger-plugins/&lt;service-type&gt;</code>目录</li>
</ol>
<h2 id="安装插件到服务中"><a href="#安装插件到服务中" class="headerlink" title="安装插件到服务中"></a>安装插件到服务中</h2><p>要想访问授权生效，Ranger插件必须先进行安装和配置。 请参看查看相关文档，如何注册一个授权（authorizer）。</p>
<h1 id="服务类型"><a href="#服务类型" class="headerlink" title="服务类型"></a>服务类型</h1><h2 id="服务类型定义"><a href="#服务类型定义" class="headerlink" title="服务类型定义"></a>服务类型定义</h2><p>一个服务的资源，如：资源访问类型（read/write/create/delete/submit/…）, 连接服务的配置信息（url/username/password/…）,在策略计算时的自定义的一些条件（IP range等）。这些都需要定义在JSON文件中，最新的服务类型定义格式请查看最新的文档<a href="https://github.com/apache/incubator-ranger/blob/master/agents-common/src/main/resources/service-defs/" target="_blank" rel="noopener">服务定义格式</a></p>
<h2 id="例子-YARN服务类型定义"><a href="#例子-YARN服务类型定义" class="headerlink" title="例子-YARN服务类型定义"></a>例子-YARN服务类型定义</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="attr">"name"</span>: <span class="string">"yarn"</span>,</span><br><span class="line"> <span class="attr">"implClass"</span>: <span class="string">"org.apache.ranger.services.yarn.RangerServiceYarn"</span>,</span><br><span class="line"> <span class="attr">"label"</span>: <span class="string">"YARN"</span>,</span><br><span class="line"> <span class="attr">"description"</span>: <span class="string">"YARN"</span>,</span><br><span class="line"> <span class="attr">"guid"</span>: <span class="string">"5b710438-edcf-4e20-834c-a9a267b5b963"</span>,</span><br><span class="line">  <span class="attr">"resources"</span>:</span><br><span class="line"> [</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="attr">"name"</span>: <span class="string">"queue"</span>,</span><br><span class="line">   <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">   <span class="attr">"level"</span>: <span class="number">10</span>,</span><br><span class="line">   <span class="attr">"mandatory"</span>: <span class="literal">true</span>,</span><br><span class="line">   <span class="attr">"lookupSupported"</span>: <span class="literal">true</span>,</span><br><span class="line">   <span class="attr">"recursiveSupported"</span>: <span class="literal">true</span>,</span><br><span class="line">   <span class="attr">"matcher"</span>: <span class="string">"org.apache.ranger.plugin.resourcematcher.RangerPathResourceMatcher"</span>,</span><br><span class="line">   <span class="attr">"matcherOptions"</span>: &#123;<span class="attr">"wildCard"</span>:<span class="literal">true</span>, <span class="attr">"ignoreCase"</span>:<span class="literal">true</span>, <span class="attr">"pathSeparatorChar"</span>:<span class="string">"."</span>&#125;,</span><br><span class="line">   <span class="attr">"label"</span>: <span class="string">"Queue"</span>,</span><br><span class="line">   <span class="attr">"description"</span>: <span class="string">"Queue"</span></span><br><span class="line">  &#125;</span><br><span class="line"> ],</span><br><span class="line"> <span class="attr">"accessTypes"</span>:</span><br><span class="line"> [</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="attr">"name"</span>: <span class="string">"submit-app"</span>,</span><br><span class="line">   <span class="attr">"label"</span>: <span class="string">"submit-app"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="attr">"name"</span>: <span class="string">"admin-queue"</span>,</span><br><span class="line">   <span class="attr">"label"</span>: <span class="string">"admin-queue"</span></span><br><span class="line">  &#125;</span><br><span class="line"> ],</span><br><span class="line"></span><br><span class="line"> <span class="attr">"configs"</span>:</span><br><span class="line"> [</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="attr">"name"</span>: <span class="string">"username"</span>,</span><br><span class="line">   <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">   <span class="attr">"mandatory"</span>: <span class="literal">true</span>,</span><br><span class="line">   <span class="attr">"label"</span>: <span class="string">"Username"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="attr">"name"</span>: <span class="string">"password"</span>,</span><br><span class="line">   <span class="attr">"type"</span>: <span class="string">"password"</span>,</span><br><span class="line">   <span class="attr">"mandatory"</span>: <span class="literal">true</span>,</span><br><span class="line">   <span class="attr">"label"</span>: <span class="string">"Password"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="attr">"name"</span>: <span class="string">"yarn.url"</span>,</span><br><span class="line">   <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">   <span class="attr">"mandatory"</span>: <span class="literal">true</span>,</span><br><span class="line">   <span class="attr">"label"</span>: <span class="string">"YARN REST URL"</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">   <span class="attr">"name"</span>: <span class="string">"commonNameForCertificate"</span>,</span><br><span class="line">   <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">   <span class="attr">"mandatory"</span>: <span class="literal">false</span>,</span><br><span class="line">   <span class="attr">"label"</span>: <span class="string">"Common Name for Certificate"</span></span><br><span class="line">  &#125;</span><br><span class="line"> ],</span><br><span class="line"></span><br><span class="line"> <span class="attr">"policyConditions"</span>:</span><br><span class="line"> [</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="attr">"name"</span>: <span class="string">"ip-range"</span>,</span><br><span class="line">   <span class="attr">"evaluator"</span>: <span class="string">"org.apache.ranger.plugin.conditionevaluator.RangerIpMatcher"</span>,</span><br><span class="line">   <span class="attr">"label"</span>: <span class="string">"IP Address Range"</span>,</span><br><span class="line">   <span class="attr">"description"</span>: <span class="string">"IP Address Range"</span></span><br><span class="line">  &#125;</span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="注册服务类型"><a href="#注册服务类型" class="headerlink" title="注册服务类型"></a>注册服务类型</h2><p>服务类型注册必须使用Ranger Admin提供的RESTFUL API来进行。 服务类型一旦注册成功，Ranger Admin就会提供一个创建服务的UI页面(在以前的发行版中叫做repositories)以及该服务的策略。 Ranger插件使用服务定义和策略来确定一个访问请求应该被允许还是被拒绝。 Ranger Admin提供的REST API可以通过<code>curl</code>这个小命令行工具调用:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -X POST -H &quot;Accept: application/json&quot; -H &quot;Content-Type: application/json&quot; –d @ranger-servicedef-yarn.json http://ranger-admin-host:port/service/plugins/definitions</span><br></pre></td></tr></table></figure></p>
<h1 id="Ranger插件开发"><a href="#Ranger插件开发" class="headerlink" title="Ranger插件开发"></a>Ranger插件开发</h1><h2 id="Ranger-Authorizer"><a href="#Ranger-Authorizer" class="headerlink" title="Ranger Authorizer"></a>Ranger Authorizer</h2><p>Ranger服务授权体系主要是通过以下方式实现的：提供一个lib，该lib实现了服务钩子(hook)拦截资源访问，并调用Ranger API获得授权以及记录审计日志。 当在某个服务里面安装ranger插件时，这些钩子会被自动注册到服务中。在这节中，我们会深入YARN ranger插件的实现细节（YARN服务类型定义已经在前面一节中做过了）。</p>
<p>在服务的初始化过程中，一个静态（或者全局的）<code>RangerBasePlugin</code>实例应该被创建出来， 该实例的引用也应该被提供出来，以方便后续访问授权请求的使用。</p>
<p>在初始化过程中，插件将会从本地缓存中加载策略（如果本地存在的话），并启动一个策略更新器用于从Ranger Admin中拉取更新后的策略。</p>
<p>YARN服务需要授权服务实现<code>YarnAuthorizationProvider</code>接口。 Ranger YARN插件实现了<code>init()</code>和<code>checkPermission()</code>方法用于提供授权和YARN队列的访问审计。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RangerYarnAuthorizer</span> <span class="keyword">extends</span> <span class="title">YarnAuthorizationProvider</span> </span>&#123;</span><br><span class="line">   	<span class="keyword">private</span> <span class="keyword">static</span> RangerBasePlugin plugin = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Configuration conf)</span> </span>&#123;</span><br><span class="line">		  plugin = <span class="keyword">new</span> RangerBasePlugin(<span class="string">"yarn"</span>, <span class="string">"yarn"</span>);</span><br><span class="line">		  plugin.init(); <span class="comment">// this will initialize policy engine and policy refresher</span></span><br><span class="line">		  plugin.setDefaultAuditHandler(<span class="keyword">new</span> RangerDefaultAuditHandler());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkPermission</span><span class="params">(AccessType accessType, PrivilegedEntity entity, UserGroupInformation ugi)</span> </span>&#123;</span><br><span class="line">		  RangerAccessRequestImpl request  = <span class="keyword">new</span> RangerAccessRequestImpl();</span><br><span class="line">		  RangerResourceImpl      resource = <span class="keyword">new</span> RangerResourceImpl();</span><br><span class="line"></span><br><span class="line">		  resource.setValue(<span class="string">"queue"</span>, entity.getName());</span><br><span class="line">		   request.setResource(resource);</span><br><span class="line">		   request.setAccessType(getRangerAccessType(accessType));</span><br><span class="line">		   request.setUser(ugi.getShortUserName());</span><br><span class="line">		   request.setUserGroups(Sets.newHashSet(ugi.getGroupNames()));</span><br><span class="line">		   request.setAccessTime(<span class="keyword">new</span> Date());</span><br><span class="line">		   request.setClientIPAddress(getRemoteIp());</span><br><span class="line">		  RangerAccessResult result = plugin.isAccessAllowed(request);</span><br><span class="line">		  <span class="keyword">return</span> result == <span class="keyword">null</span> ? <span class="keyword">false</span> : result.getIsAllowed();</span><br><span class="line"> 	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="资源查找-1"><a href="#资源查找-1" class="headerlink" title="资源查找"></a>资源查找</h2><p>在Ranger Admin中构建策略的时候，用户会输入需要保护的资源的名字。为了让用户使用更方便，Ranager Admin提供了一自动完成特性，该特性会根据输入的内容查询服务中可用的匹配资源。</p>
<p>lookup的实现是针对被访问的资源中的服务。它涉及服务提供的API以及检索可用的资源。为了完成<code>autocomplete</code>特性，Ranger Admin要求插件提供<code>RangerBaseService</code>的一个具体实现。这个实现类必须在Ranger的服务类型中注册，并且要保证该类库已经放置到了Ranger Admin的类路径下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RangerServiceYarn</span> <span class="keyword">extends</span> <span class="title">RangerBaseService</span> </span>&#123;</span><br><span class="line">	 <span class="function"><span class="keyword">public</span> HashMap&lt;String, Object&gt; <span class="title">validateConfig</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	  	<span class="comment">// <span class="doctag">TODO:</span> connect to YARN resource manager; throw Exception on failure</span></span><br><span class="line">	 &#125;</span><br><span class="line"></span><br><span class="line">	 <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">lookupResource</span><span class="params">(ResourceLookupContext context)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	  	<span class="comment">// <span class="doctag">TODO:</span> retrieve the resource list from YARN resource manager using REST API</span></span><br><span class="line">	 &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="安装和配置插件"><a href="#安装和配置插件" class="headerlink" title="安装和配置插件"></a>安装和配置插件</h1><p>以下的实现了Ranger插件的jar文件必须保证已经放置在了服务的类路径下（如YARN）：</p>
<ul>
<li>ranger-plugins-audit-&lt;version&gt;.jar</li>
<li>ranger-plugins-common-&lt;version&gt;.jar</li>
<li>ranger-plugins-cred-&lt;version&gt;.jar</li>
</ul>
<p>Ranger插件在初始化的时候会读取以下文件，也请确保以下文件已经放置在了服务的类路径下：</p>
<ul>
<li>ranger-&lt;serviceType&gt;-audit.xml</li>
<li>ranger-&lt;serviceType&gt;-security.xml</li>
<li>ranger-policymgr-ssl.xml</li>
</ul>
<p>Ranger插件需要以下配置才能正常运行，这些配置属性通常在ranger-&lt;serviceType&gt;-security.xml中。</p>
<table>
<thead>
<tr>
<th style="text-align:center">配置</th>
<th style="text-align:center">默认值</th>
<th style="text-align:center">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ranger.plugin.&lt;serviceType&gt;.service.name</td>
<td style="text-align:center">No default value. This configuration must be provided.</td>
<td style="text-align:center">Name of the service containing policies for the plugin</td>
</tr>
<tr>
<td style="text-align:center">ranger.plugin.&lt;serviceType&gt;.policy.source.impl</td>
<td style="text-align:center">org.apache.ranger.admin.client.RangerAdminRESTClient</td>
<td style="text-align:center">Name of the class used to retrieve policies.</td>
</tr>
<tr>
<td style="text-align:center">ranger.plugin.&lt;serviceType&gt;.policy.rest.url</td>
<td style="text-align:center">No default value.</td>
<td style="text-align:center">URL to Ranger Admin</td>
</tr>
<tr>
<td style="text-align:center">ranger.plugin.&lt;serviceType&gt;.policy.rest.ssl.config.file</td>
<td style="text-align:center">No default value. This configuration must be provided if SSL is enabled between plugin and Ranger Admin.</td>
<td style="text-align:center">Path to the file containing SSL details to contact Ranger Admin</td>
</tr>
<tr>
<td style="text-align:center">ranger.plugin.&lt;serviceType&gt;.policy.cache.dir</td>
<td style="text-align:center">No default value. If no valid value is specified, local caching of policies will not be done.</td>
<td style="text-align:center">Directory where Ranger policies are cached after successful retrieval from the source</td>
</tr>
<tr>
<td style="text-align:center">ranger.plugin.&lt;serviceType&gt;.policy.pollIntervalMs</td>
<td style="text-align:center">30000</td>
<td style="text-align:center">How often to poll for changes in policies?</td>
</tr>
</tbody>
</table>
</div><iframe src="/donate/?AliPayQR=/images/alipay.png&amp;WeChatQR=/images/wechat.png&amp;GitHub=null&amp;BTCQR=null&amp;BTCKEY=null&amp;PayPal=null" style="overflow-x:hidden; overflow-y:hidden; border:0xp none #fff; min-height:240px; width:100%;" frameborder="0" scrolling="no"></iframe><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://www.lpnote.com/2017/01/23/how-to-add-a-custom-plugin-in-ranger/" data-id="cjs2ys7kw008lazp59pr4prnw" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACqUlEQVR42u3aSXIDIRAEQP3/0/YDbKQqGhRzyDn5MAuJIqBdzesVXz9/rtU97Rv+/p3cefjCw8PDGw999eqEt3pqNcT3311NXzJmPDw8vNu85HV7m8R7cL55JJsEHh4e3pN5eRmdLOUrdvtdPDw8vCfz2q1ikiHg4eHhPZOXR6jJ8p2UxXkE/KWsBQ8PDy/m5cv0c/6+0t/Dw8PDG3fV58cFJtOXFO4fRouHh4d3gdeWs3kx/c0jBR/GiYeHh3eNNx/ce3zeMNs7QLCcLDw8PLyjvDb63At58xbaXpke5dN4eHh4h3jJIp4MZXKwNT8ukEzf8it4eHh413h5cTzZMPbuP5AT4+Hh4Y15bZz6zQK6DY4/9Pfw8PDwjvLa8jrfTubbw96Evtpb8fDw8EpeUi7nBwXmsW9eTH+YXDw8PLwLvHzQp8riNuSdTxAeHh7ebV798FZAPGmt1Ye98PDw8C7wTrXw9waXF+jJlB1ujOHh4eEFz+YLdxvL5kcT2lC4QOLh4eEd4rWB7GSh35v7fOn/5048PDy8o7yzEepe4+rGhOLh4eHd47VXcugqn6x8k9hrtuHh4eHd4J0aStsea3+B0f8KeHh4eBd4SVM/H1wbOox2qvdvwMPDw7vAy9tLe9MxOXCQB8FFGIGHh4d3iJeXsG3ge7ZV1o4WDw8P7zbv1PGpnL03ufmFh4eHd5vXfnh+mGASfIz2PTw8PLwBb3OpLaOE5PjUpBJePoWHh4d3gdc2mfZa+/m2MYkkRhceHh7eVj+9bfC3pKSknh/2+mdUeHh4eNd4k0NUewFu/sUDexoeHh7eA3jzDWAeAUdTiYeHh/cAXlvgtnfOY2I8PDy87/DaIKANEdrNo/0ZDmQteHh4eNNkoIhlkwK3XtCPHszCw8PDO8T7BeFz7gOyez47AAAAAElFTkSuQmCC">分享</a><div class="tags"><a href="/tags/ranger/">ranger</a><a href="/tags/大数据/">大数据</a></div><div class="post-nav"><a class="pre" href="/2017/04/10/best-practices-in-hdfs-authorization-with-apache-ranger/">Apache Ranger在HDFS中的最佳实践</a><a class="next" href="/2017/01/19/user-guide-of-prestodb-udf/">PrestoDB自定义函数开发指南</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var path = "2017/01/23/how-to-add-a-custom-plugin-in-ranger/"
var paths = path.split("/")
var lastPathLen = paths[paths.length-1].length
var finalPath = paths[paths.length-1]
if(lastPathLen == 0) {
   finalPath = paths[paths.length-2]
}
var p = finalPath.length < 50 ? finalPath : finalPath.substring(0,49)
var gitment = new Gitment({
  id: p,
  owner: 'icanfly',
  repo: 'blog_comments',
  oauth: {
    client_id: '9d8f7a953f32b2942597',
    client_secret: 'efbc1217c60b17a9ceae6b2bbc6885dc17c51ac7',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://www.lpnote.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/">leetcode</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/原创文章/">原创文章</a><span class="category-list-count">38</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/原创文章/问题记录/">问题记录</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/翻译文章/">翻译文章</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载文章/">转载文章</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/问题记录/">问题记录</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/问题解析/" style="font-size: 15px;">问题解析</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/apache/" style="font-size: 15px;">apache</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/fastjson/" style="font-size: 15px;">fastjson</a> <a href="/tags/ranger/" style="font-size: 15px;">ranger</a> <a href="/tags/hdfs/" style="font-size: 15px;">hdfs</a> <a href="/tags/大数据/" style="font-size: 15px;">大数据</a> <a href="/tags/最佳实践/" style="font-size: 15px;">最佳实践</a> <a href="/tags/hortonworks/" style="font-size: 15px;">hortonworks</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/bug/" style="font-size: 15px;">bug</a> <a href="/tags/groovy/" style="font-size: 15px;">groovy</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/配置中心/" style="font-size: 15px;">配置中心</a> <a href="/tags/DIY/" style="font-size: 15px;">DIY</a> <a href="/tags/HIVE/" style="font-size: 15px;">HIVE</a> <a href="/tags/搜索引擎/" style="font-size: 15px;">搜索引擎</a> <a href="/tags/lucene/" style="font-size: 15px;">lucene</a> <a href="/tags/elasticsearch/" style="font-size: 15px;">elasticsearch</a> <a href="/tags/IDE/" style="font-size: 15px;">IDE</a> <a href="/tags/IDEA/" style="font-size: 15px;">IDEA</a> <a href="/tags/json/" style="font-size: 15px;">json</a> <a href="/tags/jackson/" style="font-size: 15px;">jackson</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/并发/" style="font-size: 15px;">并发</a> <a href="/tags/源码解读/" style="font-size: 15px;">源码解读</a> <a href="/tags/基础问题/" style="font-size: 15px;">基础问题</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/leetcode/" style="font-size: 15px;">leetcode</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/centos/" style="font-size: 15px;">centos</a> <a href="/tags/vim/" style="font-size: 15px;">vim</a> <a href="/tags/mac/" style="font-size: 15px;">mac</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/Mybatis/" style="font-size: 15px;">Mybatis</a> <a href="/tags/ORM/" style="font-size: 15px;">ORM</a> <a href="/tags/负载均衡/" style="font-size: 15px;">负载均衡</a> <a href="/tags/guava/" style="font-size: 15px;">guava</a> <a href="/tags/踩坑/" style="font-size: 15px;">踩坑</a> <a href="/tags/session/" style="font-size: 15px;">session</a> <a href="/tags/druid/" style="font-size: 15px;">druid</a> <a href="/tags/rpm/" style="font-size: 15px;">rpm</a> <a href="/tags/tomcat/" style="font-size: 15px;">tomcat</a> <a href="/tags/jetty/" style="font-size: 15px;">jetty</a> <a href="/tags/gc/" style="font-size: 15px;">gc</a> <a href="/tags/presto/" style="font-size: 15px;">presto</a> <a href="/tags/OOM/" style="font-size: 15px;">OOM</a> <a href="/tags/GC/" style="font-size: 15px;">GC</a> <a href="/tags/SVN/" style="font-size: 15px;">SVN</a> <a href="/tags/版本控制/" style="font-size: 15px;">版本控制</a> <a href="/tags/VCS/" style="font-size: 15px;">VCS</a> <a href="/tags/分支管理/" style="font-size: 15px;">分支管理</a> <a href="/tags/virtualbox/" style="font-size: 15px;">virtualbox</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/timewheels/" style="font-size: 15px;">timewheels</a> <a href="/tags/timer/" style="font-size: 15px;">timer</a> <a href="/tags/yarn/" style="font-size: 15px;">yarn</a> <a href="/tags/SpringCloud/" style="font-size: 15px;">SpringCloud</a> <a href="/tags/微服务/" style="font-size: 15px;">微服务</a> <a href="/tags/metrics/" style="font-size: 15px;">metrics</a> <a href="/tags/ambari/" style="font-size: 15px;">ambari</a> <a href="/tags/参与开源/" style="font-size: 15px;">参与开源</a> <a href="/tags/timewheel/" style="font-size: 15px;">timewheel</a> <a href="/tags/skywalking/" style="font-size: 15px;">skywalking</a> <a href="/tags/apm/" style="font-size: 15px;">apm</a> <a href="/tags/SQL/" style="font-size: 15px;">SQL</a> <a href="/tags/solr/" style="font-size: 15px;">solr</a> <a href="/tags/rocketmq/" style="font-size: 15px;">rocketmq</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/dubbo/" style="font-size: 15px;">dubbo</a> <a href="/tags/问题分析/" style="font-size: 15px;">问题分析</a> <a href="/tags/github/" style="font-size: 15px;">github</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/02/13/ignore_above-in-elasticsearch/">Elasticsearch中ignore_above的作用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/02/java-concurrent-striped64/">java并发之Striped64解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/31/memory-leak-analysis-for-skywalking/">一次Skywalking内存泄露的原因分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/31/write-combining/">合并写(write combining)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/31/false-sharing/">伪共享(False Sharing)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/08/groovy-expr-usage/">groovy-expr-usage</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/08/jackson-ctrl-char-problem-resovle/">jackson-ctrl-char-problem-resovle</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/04/solve-a-disk-warning-illusion-caused-by-rocketmq/">solve-a-disk-warning-illusion-caused-by-rocketmq</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/30/hexoclient-usage/">hexoclient-usage</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/23/customize-instance-id-with-consul-service-registry/">定制springcloud服务注册到consul中的instanceId</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">LP's Notes.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo. </a><a rel="nofollow" target="_blank" href="https://coding.net">Hosted by Coding Pages.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>